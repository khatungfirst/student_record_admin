(window.webpackJsonp=window.webpackJsonp||[]).push([["chunk-1313"],{"/Hsc":function(e,t,a){"use strict";var r=a("/mMj");a.n(r).a},"/mMj":function(e,t,a){},JCNI:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getArticleList=function(e){return(0,o.default)({url:"/article/list",method:"post",data:e})},t.getArticleDetail=function(e,t){return(0,o.default)({url:"/article/content",method:"post",data:{article_id:e,username:t}})},t.deleteArticle=function(e){var t={article_id:e};return(0,o.default)({url:"/article/delete",method:"post",data:t})},t.articleBan=function(e,t){return(0,o.default)({url:"/article/ban",method:"post",data:{article_id:e,article_ban:t}})},t.ExcellentPost=function(e){return(0,o.default)({url:"/article/select_good_article",method:"post",data:e})},t.getGoodArticle=function(e){return(0,o.default)({url:"/article/getGoodArticles",method:"post",data:e})};var r,l=a("t3Un"),o=(r=l)&&r.__esModule?r:{default:r}},XyZo:function(e,t,a){"use strict";a.r(t);var r=a("syY0"),l=a.n(r);for(var o in r)"default"!==o&&function(e){a.d(t,e,function(){return r[e]})}(o);t.default=l.a},cCOA:function(e,t,a){"use strict";a.r(t);var r=a("ju4o"),l=a("XyZo");for(var o in l)"default"!==o&&function(e){a.d(t,e,function(){return l[e]})}(o);a("/Hsc");var s=a("KHd+"),i=Object(s.a)(l.default,r.a,r.b,!1,null,"841223ce",null);i.options.__file="index.vue",t.default=i.exports},ju4o:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"post-management"},[a("div",{staticClass:"search-bar"},[a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:e.searchForm}},[a("el-form-item",{attrs:{label:"发布时间"}},[a("el-date-picker",{attrs:{type:"daterange","range-separator":"至","start-placeholder":"开始时间","end-placeholder":"结束时间"},model:{value:e.searchForm.publishTime,callback:function(t){e.$set(e.searchForm,"publishTime",t)},expression:"searchForm.publishTime"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"是否被封禁"}},[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.searchForm.article_ban,callback:function(t){e.$set(e.searchForm,"article_ban",t)},expression:"searchForm.article_ban"}},[a("el-option",{attrs:{label:"请选择",value:""}}),e._v(" "),a("el-option",{attrs:{label:"封禁",value:!0}}),e._v(" "),a("el-option",{attrs:{label:"正常",value:!1}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"发布人"}},[a("el-input",{attrs:{placeholder:"请输入发布人"},model:{value:e.searchForm.name,callback:function(t){e.$set(e.searchForm,"name",t)},expression:"searchForm.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:e.handleSearch}},[e._v("搜索")]),e._v(" "),a("el-button",{on:{click:e.handleReset}},[e._v("重置")]),e._v(" "),a("el-button",{on:{click:e.handleShowAll}},[e._v(e._s(e.showAllText))])],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.postList},on:{"sort-change":e.changeSort}},[a("el-table-column",{attrs:{prop:"article_id",label:"帖子ID",width:"120"}}),e._v(" "),a("el-table-column",{staticClass:"content-ellipsis",attrs:{prop:"article_content",label:"帖子内容"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("div",{staticClass:"content-ellipsis"},[e._v(e._s(r.article_content))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"article_ban",label:"状态"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[a("i",{staticClass:"status-icon",class:r.article_ban?"el-icon-lock":"el-icon-circle-check"}),e._v(" "),a("span",{class:r.article_ban?"banned":"normal"},[e._v("\n          "+e._s(r.article_ban?"封禁":"正常")+"\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"upvote_amount",label:"点赞数",sortable:"true",order:"asc"}}),e._v(" "),a("el-table-column",{attrs:{prop:"collect_amount",label:"收藏数",sortable:"true"}}),e._v(" "),a("el-table-column",{attrs:{prop:"name",label:" 发布人"}}),e._v(" "),a("el-table-column",{attrs:{prop:"article_quality",label:"优秀帖子"},scopedSlots:e._u([{key:"default",fn:function(t){var r=t.row;return[0===r.article_quality?a("span",[e._v("普通帖子")]):e._e(),e._v(" "),1===r.article_quality?a("span",[e._v("班级优秀帖子")]):e._e(),e._v(" "),2===r.article_quality?a("span",[e._v("年级优秀帖子")]):e._e(),e._v(" "),3===r.article_quality?a("span",[e._v("院级优秀帖子")]):e._e(),e._v(" "),a("span")]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"发布时间",sortable:"true"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.formatDateTime(t.row.created_at)))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.handleBan(t.row)}}},[e._v("封禁")]),e._v(" "),a("el-button",{staticClass:"delete-button",attrs:{type:"text"},on:{click:function(a){return e.handleDel(t.row)}}},[e._v("删除")]),e._v(" "),a("el-button",{staticClass:"detail-button",attrs:{type:"text"},on:{click:function(a){return e.showArticleDetail(t.row)}}},[e._v("查看详情")]),e._v(" "),a("el-button",{staticClass:"excellent-button",attrs:{type:"text"},on:{click:function(a){return e.handleSelectExcellent(t.row)}}},[e._v("评为优秀帖子")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"帖子详情",visible:e.dialogDetailVisible,"modal-append-to-body":!1,"append-to-body":!0},on:{"update:visible":function(t){e.dialogDetailVisible=t}},model:{value:e.dialogDetailVisible,callback:function(t){e.dialogDetailVisible=t},expression:"dialogDetailVisible"}},[e.articleDetail?a("div",[a("p",e._l(e.articleDetail.article_tags,function(t,r){return a("span",{key:r,staticClass:"tag-style"},[e._v("\n          "+e._s(t)+"\n          "),r<e.articleDetail.article_tags.length-1?a("span",[e._v(", ")]):e._e()])}),0),e._v(" "),a("p",[e._v("帖子内容: "+e._s(e.processedContent))])]):e._e()]),e._v(" "),a("el-dialog",{attrs:{title:"选择优秀帖子类型",visible:e.dialogExcellentVisible,modal:!1},on:{"update:visible":function(t){e.dialogExcellentVisible=t}},model:{value:e.dialogExcellentVisible,callback:function(t){e.dialogExcellentVisible=t},expression:"dialogExcellentVisible"}},[a("el-form",[a("el-form-item",[a("el-select",{attrs:{placeholder:"请选择"},model:{value:e.article_quality,callback:function(t){e.article_quality=t},expression:"article_quality"}},["college"===e.role||"superman"===e.role?a("el-option",{attrs:{label:"院级优秀帖子",value:3}}):e._e(),e._v(" "),"superman"===e.role||"college"===e.role||"grade1"===e.role||"grade2"===e.role||"grade3"===e.role||"grade4"===e.role?a("el-option",{attrs:{label:"年级优秀帖子",value:2}}):e._e(),e._v(" "),"superman"===e.role||"college"===e.role||"grade1"===e.role||"grade2"===e.role||"grade3"===e.role||"grade4"===e.role||"class"===e.role?a("el-option",{attrs:{label:"班级优秀帖子",value:1}}):e._e()],1)],1)],1),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:function(t){e.dialogExcellentVisible=!1}}},[e._v("取消")]),e._v(" "),a("el-button",{attrs:{type:"primary"},on:{click:e.handleSubmit}},[e._v("确定")])],1)],1),e._v(" "),a("div",{staticClass:"pagination"},[a("el-pagination",{attrs:{"current-page":e.currentPage,"page-size":e.pageSize,layout:"total, prev, pager, next",total:e.totalPosts},on:{"current-change":e.handleCurrentChange,"update:currentPage":function(t){e.currentPage=t},"update:current-page":function(t){e.currentPage=t}}})],1)],1)},l=[];a.d(t,"a",function(){return r}),a.d(t,"b",function(){return l})},syY0:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=i(a("4d7F")),l=i(a("14Xm")),o=i(a("D3Ub")),s=a("JCNI");function i(e){return e&&e.__esModule?e:{default:e}}t.default={name:"articlemanagement",data:function(){return{searchForm:{publishTime:[],article_ban:!1,name:""},allPostsCurrentPage:1,goodPostsCurrentPage:1,pageSize:10,totalPosts:0,postList:[],dialogDetailVisible:!1,dialogExcellentVisible:!1,articleDetail:null,sort:"created_at",order:"desc",topic:"",key_words:"",currentSortColumn:"upvote_amount",article_quality:"请选择",role:"college",showAll:!1,showAllText:"切换全部数据"}},computed:{currentPosts:function(){var e=(this.currentPage-1)*this.pageSize,t=e+this.pageSize;return this.allPosts.slice(e,t)},processedContent:function(){return(new DOMParser).parseFromString(this.articleDetail.article_content.article_text,"text/html").body.textContent||" "}},created:function(){this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order,showAll:this.showAll}),this.currentPage=this.showAll?this.allPostsCurrentPage:this.goodPostsCurrentPage},methods:{formatDateTime:function(e){var t=new Date(e);return isNaN(t.getTime())?(console.error("无效的日期:",e),"无效的日期"):t.getFullYear()+"-"+(t.getMonth()+1).toString().padStart(2,"0")+"-"+t.getDate().toString().padStart(2,"0")+" "+t.getHours().toString().padStart(2,"0")+":"+t.getMinutes().toString().padStart(2,"0")+":"+t.getSeconds().toString().padStart(2,"0")},fetchPosts:function(e){var t=this;return(0,o.default)(l.default.mark(function a(){var r;return l.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,console.log(e,"12334333"),a.next=4,e.showAll?(0,s.getArticleList)(e):(0,s.getGoodArticle)(e);case 4:if(r=a.sent,console.log("我是帖子列表L:",r),!r||200!==r.code){a.next=11;break}t.updatePostList(r.data),t.totalPosts=r.data.article_amount,a.next=12;break;case 11:throw new Error("API request failed with code: "+r.code);case 12:a.next=20;break;case 14:a.prev=14,a.t0=a.catch(0),console.error("Error fetching posts:",a.t0),t.$message.error("获取帖子列表失败"),t.postList=[],t.totalPosts=0;case 20:case"end":return a.stop()}},a,t,[[0,14]])}))()},handleShowAll:function(){this.showAll=!this.showAll,this.showAllText=this.showAll?"切换优秀帖子":"切换全部数据",this.currentPage=this.showAll?this.allPostsCurrentPage:this.goodPostsCurrentPage,this.showAll,this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order,showAll:this.showAll})},updatePostList:function(e){e&&Array.isArray(e.list)?(this.totalPosts=e.total,this.postList=e.list):(console.error("Received data is not in the expected format:",e),this.postList=[],this.totalPosts=0)},showArticleDetail:function(e){var t=this;return(0,o.default)(l.default.mark(function a(){var r;return l.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,console.log("我是row",e),a.next=4,(0,s.getArticleDetail)(e.article_id,e.username);case 4:if(r=a.sent,console.log("我是response",r),console.log(e.article_id),!r||200!==r.code){a.next=14;break}t.articleDetail=r.data,console.log(t.articleDetail,"articleDetail"),t.dialogDetailVisible=!0,console.log(t.dialogDetailVisible),a.next=15;break;case 14:throw new Error("API request failed with code: "+r.code);case 15:a.next=22;break;case 17:a.prev=17,a.t0=a.catch(0),console.error("Error fetching article detail:",a.t0),t.$message.error("获取帖子详情失败"),t.dialogDetailVisible=!1;case 22:case"end":return a.stop()}},a,t,[[0,17]])}))()},handleSelectExcellent:function(e){this.article_id=e.article_id,this.dialogExcellentVisible=!0},handleSubmit:function(){var e=this;this.dialogExcellentVisible=!1;var t={article_id:this.article_id,article_quality:Number(this.article_quality)};(0,s.ExcellentPost)(t).then(function(t){200===t.code?(e.$message.success("评为优秀帖子成功"),e.fetchPosts({page:e.currentPage,limit:e.pageSize,sort:e.sort,order:e.order})):e.$message.error("操作失败")}).catch(function(t){console.log("Error:",t),e.$message.error("操作失败")})},getPostsFromAPI:function(){var e=this;return new r.default(function(t){setTimeout(function(){t(e.allPosts)},1e3)})},handleSearch:function(){var e={page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order,start_at:this.searchForm.publishTime[0]||"",end_at:this.searchForm.publishTime[1]||"",topic:"",key_words:"",name:this.searchForm.name,article_ban:""===this.searchForm.article_ban?void 0:this.searchForm.article_ban,showAll:this.showAll};this.fetchPosts(e)},handleReset:function(){this.searchForm={publishTime:[],article_ban:!1,name:""},this.sort="created_at",this.order="desc",this.showAll=!1,this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order,showAll:this.showAll,article_ban:this.searchForm.article_ban})},handleBan:function(e){var t=this;return(0,o.default)(l.default.mark(function a(){var r,o;return l.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("封禁帖子:",e),a.prev=1,r=e.article_id,o=!0===e.article_ban,a.next=6,(0,s.articleBan)(r,o);case 6:t.$message.success("封禁帖子成功"),t.fetchPosts({page:t.currentPage,limit:t.pageSize,sort:t.sort,order:t.order}),a.next=14;break;case 10:a.prev=10,a.t0=a.catch(1),console.error("封禁帖子失败",a.t0),t.$message.error("封禁帖子失败");case 14:case"end":return a.stop()}},a,t,[[1,10]])}))()},handleDel:function(e){var t=this;return(0,o.default)(l.default.mark(function a(){var r;return l.default.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return console.log("删除帖子:",e),a.prev=1,r=e.article_id,a.next=5,(0,s.deleteArticle)(r);case 5:t.$message.success("删除帖子成功"),t.fetchPosts({page:t.currentPage,limit:t.pageSize,sort:t.sort,order:t.order}),a.next=13;break;case 9:a.prev=9,a.t0=a.catch(1),console.error("删除帖子失败",a.t0),t.$message.error("删除帖子失败");case 13:case"end":return a.stop()}},a,t,[[1,9]])}))()},handleSizeChange:function(e){this.pageSize=e,this.currentPage=1,this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order})},handleCurrentChange:function(e){this.showAll?this.allPostsCurrentPage=e:this.goodPostsCurrentPage=e,this.currentPage=e,this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order,showAll:this.showAll})},handleSortChange:function(e){this.currentSortColumn=e,this.changeSort(e)},changeSort:function(e){var t=e.prop,a=e.order,r="created_at";switch(t){case"upvote_amount":r="like_amount";break;case"collect_amount":r="collect_amount";break;case"created_at":r="created_at"}this.sort=r,this.order="ascending"===a?"asc":"descending"===a?"desc":"asc",this.fetchPosts({page:this.currentPage,limit:this.pageSize,sort:this.sort,order:this.order})}}}}}]);